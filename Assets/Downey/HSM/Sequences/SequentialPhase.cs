using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

namespace Downey.HSM
{
    /// <summary>
    /// 顺序处理
    /// </summary>
    public class SequentialPhase : ISequence
    {
        readonly List<PhaseStep> steps;
        private readonly CancellationToken ct;
        private int index = -1;
        private Task current;
        public bool IsDone { get; private set; }
        
        public SequentialPhase(List<PhaseStep> steps, CancellationToken ct)
        {
            this.steps = steps;
            this.ct = ct;
        }

        public void Start() => Next();
        public bool Update()
        {
            if(IsDone) return true;
            if(current==null||current.IsCompleted) Next();
            return IsDone;
        }
        void Next()
        {
            index++;
            if(index >= steps.Count){IsDone = true; return;}

            current = steps[index](ct);
        }

        
    }
}